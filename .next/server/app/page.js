(()=>{var e={};e.id=931,e.ids=[931],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},675:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GlobalError:()=>o.a,__next_app__:()=>u,originalPathname:()=>p,pages:()=>c,routeModule:()=>f,tree:()=>d}),i(7288),i(7764),i(5866);var n=i(3191),r=i(8716),a=i(7922),o=i.n(a),s=i(5231),l={};for(let e in s)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>s[e]);i.d(t,l);let d=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(i.bind(i,7288)),"/Users/aprameyakannan/Documents/ironminer/app/page.js"]}]},{layout:[()=>Promise.resolve().then(i.bind(i,7764)),"/Users/aprameyakannan/Documents/ironminer/app/layout.js"],"not-found":[()=>Promise.resolve().then(i.t.bind(i,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/aprameyakannan/Documents/ironminer/app/page.js"],p="/page",u={require:i,loadChunk:()=>Promise.resolve()},f=new n.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},5030:(e,t,i)=>{Promise.resolve().then(i.bind(i,8358))},3315:()=>{},5319:(e,t,i)=>{Promise.resolve().then(i.t.bind(i,2994,23)),Promise.resolve().then(i.t.bind(i,6114,23)),Promise.resolve().then(i.t.bind(i,9727,23)),Promise.resolve().then(i.t.bind(i,9671,23)),Promise.resolve().then(i.t.bind(i,1868,23)),Promise.resolve().then(i.t.bind(i,4759,23))},8358:(e,t,i)=>{"use strict";i.d(t,{default:()=>$});var n=i(326),r=i(7577);let a={bg:"#0f172a",surface:"#1e293b",surface2:"#273449",border:"#334155",text:"#f1f5f9",muted:"#64748b",orange:"#f97316",green:"#22c55e",yellow:"#facc15",red:"#ef4444",blue:"#60a5fa"},o={baseline:"Describe what is happening in this construction site image.",zoneDecomposition:"Divide this construction site image into spatial zones (foreground/midground/background, left/center/right, ground level/elevated). For each zone describe: what trade or activity is present, how many workers, what equipment and materials occupy the space, and how crowded the zone is on a 1–5 scale (1=empty, 5=severely congested). Use clear zone headers. Be specific about locations.",entityRelationship:"Based on this construction site image and the zone analysis above, describe the spatial relationships: which trades are working adjacent to each other, where are movement corridors blocked or narrow, where is equipment creating clearance issues, and which zones have multiple trades competing for the same space. Be specific about locations and consequences.",temporal:(e,t)=>`Previous site analysis (${t}):
${e}

Now compare against the current frame. What has changed spatially? Have congestion hotspots shifted? Have new trade overlaps appeared? Has any area cleared? Rate the overall congestion trend: improving, stable, or worsening. Be specific about what changed and where.`,briefing:"Summarize the spatial analysis as a briefing for a non-technical construction site manager. Plain language only — no jargon. Lead with the single most important issue. Keep it under 150 words. End with one specific, actionable recommendation a manager can act on right now."};async function s(e,t,i=1024){let n=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"x-api-key":e,"anthropic-version":"2023-06-01","content-type":"application/json","anthropic-dangerous-direct-browser-access":"true"},body:JSON.stringify({model:"claude-sonnet-4-6",max_tokens:i,messages:t})});if(!n.ok){let e=await n.json().catch(()=>({}));throw Error(e.error?.message||`API error ${n.status}`)}return(await n.json()).content[0].text}function l(e,t){let i="image/jpeg",n=e;if(e.startsWith("data:")){let t=e.match(/^data:([^;]+);base64,(.+)$/);t&&(i=t[1],n=t[2])}return{role:"user",content:[{type:"image",source:{type:"base64",media_type:i,data:n}},{type:"text",text:t}]}}async function d(e,t,i=null){let n=await s(e,[l(t.imageData,o.zoneDecomposition)],1024),r=await s(e,[l(t.imageData,o.zoneDecomposition),{role:"assistant",content:n},{role:"user",content:o.entityRelationship}],1024),a=null;i&&(a=await s(e,[l(t.imageData,o.temporal(i,"previous frame"))],768));let d=[`Zone Analysis:
${n}`,`Spatial Relationships:
${r}`,a?`Temporal Changes:
${a}`:""].filter(Boolean).join("\n\n---\n\n");return{zoneAnalysis:n,relationships:r,temporal:a,briefing:await s(e,[{role:"user",content:`${d}

---

${o.briefing}`}],512),ts:new Date().toISOString()}}async function c(e,t=5,i){return new Promise((n,r)=>{let a=document.createElement("video"),o=document.createElement("canvas"),s=o.getContext("2d"),l=[];a.onloadedmetadata=()=>{o.width=Math.min(a.videoWidth,960),o.height=Math.round(o.width*a.videoHeight/a.videoWidth);let r=[];for(let e=0;e<a.duration;e+=t)r.push(e);let d=0,c=()=>{if(d>=r.length){URL.revokeObjectURL(a.src),n(l);return}a.currentTime=r[d]};a.onseeked=()=>{s.drawImage(a,0,0,o.width,o.height),l.push({id:`v${Date.now()}_${d}`,siteId:u(e.name),timestamp:r[d],imageData:o.toDataURL("image/jpeg",.82),filename:`${e.name} @${Math.round(r[d])}s`}),i?.(d+1,r.length),d++,c()},c()},a.onerror=r,a.src=URL.createObjectURL(e)})}async function p(e){return new Promise((t,i)=>{let n=new FileReader;n.onload=i=>{let n=e.name.match(/(\d{10,13})/);t({id:`i${Date.now()}_${Math.random().toString(36).slice(2,7)}`,siteId:u(e.name),timestamp:n?parseInt(n[1]):Date.now(),imageData:i.target.result,filename:e.name})},n.onerror=i,n.readAsDataURL(e)})}function u(e){for(let t of[/^(site[-_]\w+)/i,/^([A-Z]\d{3,})/i,/^(\w+?)[-_.]/]){let i=e.match(t);if(i)return i[1].toUpperCase().slice(0,12)}return e.replace(/\.[^.]+$/,"").slice(0,8).toUpperCase()||"SITE-01"}function f(e){if(!e)return"none";let t=e.toLowerCase();return t.includes("critical")||t.includes("danger")||t.includes("immediate")||t.includes("unsafe")?"critical":t.includes("congest")||t.includes("block")||t.includes("overlap")||t.includes("crowd")||t.includes("risk")?"warning":"ok"}function g({apiKey:e,onKey:t,mode:i,onMode:o}){let[s,l]=(0,r.useState)(!1);return(0,n.jsxs)("div",{style:B.nav,children:[(0,n.jsxs)("div",{style:B.navBrand,children:[(0,n.jsxs)("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",style:{marginRight:8},children:[n.jsx("polygon",{points:"12,2 22,8 22,16 12,22 2,16 2,8",stroke:a.orange,strokeWidth:"2",fill:"none"}),n.jsx("polygon",{points:"12,7 17,10 17,14 12,17 7,14 7,10",fill:a.orange,opacity:"0.6"})]}),n.jsx("span",{style:B.navTitle,children:"IronSite Manager"})]}),n.jsx("div",{style:B.navTabs,children:[["review","Review"],["live","Live"],["experiments","Experiments"]].map(([e,t])=>n.jsx("button",{style:{...B.navTab,...i===e?B.navTabOn:{}},onClick:()=>o(e),children:t},e))}),(0,n.jsxs)("div",{style:B.navKey,children:[(0,n.jsxs)("div",{style:B.keyWrap,children:[n.jsx("input",{type:s?"text":"password",placeholder:"sk-ant-... API key",value:e,onChange:e=>t(e.target.value),style:B.keyInput}),n.jsx("button",{style:B.keyEye,onClick:()=>l(e=>!e),children:s?"\uD83D\uDE48":"\uD83D\uDC41"})]}),e&&n.jsx("span",{style:{color:a.green,fontSize:18},children:"●"})]})]})}function m({sites:e,analyses:t,siteBriefs:i,chains:a,loading:o,ingesting:s,ingestProg:l,selectedSite:d,onSelectSite:c,onIngest:p,onRunBaseline:u,onRunTechnique:f,onRunChain:g,siteAlertLevel:m,apiKey:b}){let v=(0,r.useMemo)(()=>Object.keys(e).sort((e,t)=>{let i={critical:3,warning:2,ok:1,none:0};return i[m(t)]-i[m(e)]}),[e,i]);return d?n.jsx(y,{siteId:d,frames:e[d]||[],analyses:t,briefing:i[d],chain:a[d],loading:o,onBack:()=>c(null),onRunBaseline:u,onRunTechnique:f,onRunChain:()=>g(d),apiKey:b}):(0,n.jsxs)("div",{style:B.reviewWrap,children:[n.jsx(h,{onIngest:p,ingesting:s,prog:l}),0===v.length&&!s&&n.jsx(R,{icon:"\uD83C\uDFD7",title:"No sites loaded",sub:"Drop footage above — videos or image sequences accepted"}),v.length>0&&n.jsx("div",{style:B.siteGrid,children:v.map(t=>n.jsx(x,{siteId:t,frames:e[t],briefing:i[t],level:m(t),busy:!!o[`chain_${t}`],onOpen:()=>c(t),onAnalyze:()=>g(t),hasKey:!!b},t))})]})}function h({onIngest:e,ingesting:t,prog:i}){let a=(0,r.useRef)(),[o,s]=(0,r.useState)(!1);return(0,n.jsxs)("div",{style:{...B.dropzone,...o?B.dropzoneDrag:{}},onDragOver:e=>{e.preventDefault(),s(!0)},onDragLeave:()=>s(!1),onDrop:t=>{t.preventDefault(),s(!1),e(t.dataTransfer.files)},onClick:()=>!t&&a.current.click(),children:[n.jsx("input",{ref:a,type:"file",multiple:!0,accept:"video/*,image/*",style:{display:"none"},onChange:t=>e(t.target.files)}),t?(0,n.jsxs)("div",{style:B.ingestState,children:[n.jsx(I,{}),i&&(0,n.jsxs)("div",{style:B.ingestText,children:["Extracting ",i.file," — frame ",i.cur," of ",i.tot]})]}):(0,n.jsxs)(n.Fragment,{children:[n.jsx("div",{style:B.dropIcon,children:"↑"}),n.jsx("div",{style:B.dropTitle,children:"Drop footage here"}),n.jsx("div",{style:B.dropSub,children:"MP4 \xb7 MOV \xb7 WEBM \xb7 JPG \xb7 PNG — click to browse"})]})]})}function x({siteId:e,frames:t,briefing:i,level:r,busy:o,onOpen:s,onAnalyze:l,hasKey:d}){let c={critical:a.red,warning:a.orange,ok:a.green,none:a.border},p=t[0]?.imageData;return(0,n.jsxs)("div",{style:{...B.siteCard,borderColor:c[r]},onClick:s,children:[p?(0,n.jsxs)("div",{style:B.cardThumbWrap,children:[n.jsx("img",{src:p,style:B.cardThumb,alt:e}),"none"!==r&&n.jsx("div",{style:{...B.cardBadge,background:c[r]},children:{critical:"⚠ CRITICAL",warning:"! CONGESTION",ok:"✓ CLEAR",none:""}[r]}),(0,n.jsxs)("div",{style:B.cardFrameCount,children:[t.length," frames"]})]}):n.jsx("div",{style:B.cardNoThumb,children:"No frames"}),(0,n.jsxs)("div",{style:B.cardBody,children:[n.jsx("div",{style:B.cardTitle,children:e}),i?(0,n.jsxs)("div",{style:B.cardBriefPreview,children:[i.text.slice(0,110),"…"]}):n.jsx("div",{style:{...B.cardBriefPreview,color:a.muted,fontStyle:"italic"},children:"Not yet analyzed"}),(0,n.jsxs)("div",{style:B.cardActions,onClick:e=>e.stopPropagation(),children:[n.jsx(T,{onClick:s,children:"View →"}),d&&!i&&n.jsx(T,{secondary:!0,onClick:l,disabled:o,children:o?"Analyzing…":"Analyze Site"})]})]})]})}function y({siteId:e,frames:t,analyses:i,briefing:a,chain:o,loading:s,onBack:l,onRunBaseline:d,onRunTechnique:c,onRunChain:p,apiKey:u}){let[f,g]=(0,r.useState)("briefing"),[m,h]=(0,r.useState)(t[0]||null),x=!!s[`chain_${e}`];return(0,n.jsxs)("div",{style:B.detail,children:[(0,n.jsxs)("div",{style:B.detailHeader,children:[n.jsx("button",{style:B.backBtn,onClick:l,children:"← Back"}),n.jsx("div",{style:B.detailTitle,children:e}),(0,n.jsxs)("div",{style:B.detailMeta,children:[t.length," frames"]}),n.jsx("div",{style:{flex:1}}),u&&n.jsx(T,{onClick:p,disabled:x,children:x?"Analyzing…":"▶ Run Full Analysis"})]}),n.jsx("div",{style:B.tabs,children:[["briefing","Manager Briefing"],["frames","Frame Analysis"],["timeline","Timeline"]].map(([e,t])=>n.jsx("button",{style:{...B.tab,...f===e?B.tabOn:{}},onClick:()=>g(e),children:t},e))}),(0,n.jsxs)("div",{style:B.detailBody,children:["briefing"===f&&n.jsx(b,{briefing:a,busy:x}),"frames"===f&&n.jsx(v,{frames:t,analyses:i,selFrame:m,onSel:h,loading:s,onBaseline:d,onTechnique:c,apiKey:u}),"timeline"===f&&n.jsx(j,{chain:o,busy:x})]})]})}function b({briefing:e,busy:t}){if(t)return n.jsx(z,{text:"Running spatial analysis chain…"});if(!e)return n.jsx(R,{icon:"\uD83D\uDCCB",title:"No briefing yet",sub:"Click 'Run Full Analysis' to generate a site briefing"});let i=f(e.text),r={critical:a.red,warning:a.orange,ok:a.green,none:a.blue}[i];return n.jsx("div",{style:B.briefingWrap,children:(0,n.jsxs)("div",{style:{...B.briefingCard,borderColor:r},children:[(0,n.jsxs)("div",{style:B.briefingTop,children:[n.jsx("div",{style:{...B.briefingBadge,color:r},children:"SITE BRIEFING"}),n.jsx("div",{style:B.briefingTs,children:new Date(e.ts).toLocaleString()})]}),n.jsx("div",{style:B.briefingText,children:e.text})]})})}function v({frames:e,analyses:t,selFrame:i,onSel:r,loading:o,onBaseline:s,onTechnique:l,apiKey:d}){let c=i?t[i.id]:null,p=i&&!!o[`bl_${i.id}`],u=i&&!!o[`tc_${i.id}`];return(0,n.jsxs)("div",{style:B.framesLayout,children:[n.jsx("div",{style:B.frameList,children:e.map(e=>(0,n.jsxs)("div",{style:{...B.frameItem,...i?.id===e.id?B.frameItemOn:{}},onClick:()=>r(e),children:[n.jsx("img",{src:e.imageData,style:B.frameItemThumb,alt:e.filename}),n.jsx("div",{style:B.frameItemName,children:e.filename?.slice(0,22)}),t[e.id]&&n.jsx("div",{style:B.frameItemDone,children:"✓"})]},e.id))}),(0,n.jsxs)("div",{style:B.frameMain,children:[!i&&n.jsx(R,{icon:"\uD83D\uDDBC",title:"Select a frame",sub:"Choose from the list on the left"}),i&&(0,n.jsxs)(n.Fragment,{children:[n.jsx("img",{src:i.imageData,style:B.frameImg,alt:"frame"}),d&&(0,n.jsxs)("div",{style:B.frameActions,children:[n.jsx(T,{secondary:!0,onClick:()=>s(i),disabled:p,children:p?"Running…":"Run Baseline"}),n.jsx(T,{onClick:()=>l(i),disabled:u,children:u?"Analyzing…":"▶ Run Technique"})]}),(p||u)&&n.jsx(z,{text:u?"Running 4-step spatial chain…":"Running baseline prompt…"}),c&&(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[n.jsx(D,{title:"Zone Analysis",content:c.zoneAnalysis}),n.jsx(D,{title:"Spatial Relationships",content:c.relationships}),c.temporal&&n.jsx(D,{title:"Temporal Changes",content:c.temporal,accent:a.yellow}),n.jsx(D,{title:"Manager Briefing",content:c.briefing,accent:a.orange})]})]})]})]})}function j({chain:e,busy:t}){return t?n.jsx(z,{text:"Running temporal chain…"}):e?.length?n.jsx("div",{style:B.timeline,children:e.map(({frame:t,analysis:i},r)=>(0,n.jsxs)("div",{style:B.tlItem,children:[(0,n.jsxs)("div",{style:B.tlStep,children:[n.jsx("div",{style:B.tlNum,children:r+1}),r<e.length-1&&n.jsx("div",{style:B.tlLine})]}),(0,n.jsxs)("div",{style:B.tlContent,children:[n.jsx("img",{src:t.imageData,style:B.tlThumb,alt:""}),(0,n.jsxs)("div",{style:B.tlText,children:[n.jsx("div",{style:B.tlFile,children:t.filename}),n.jsx("div",{style:B.tlBrief,children:i.briefing}),i.temporal&&(0,n.jsxs)("div",{style:B.tlDelta,children:[n.jsx("span",{style:{color:a.yellow,fontWeight:600},children:"Δ Changes: "}),i.temporal.slice(0,220),"…"]})]})]})]},t.id))}):n.jsx(R,{icon:"\uD83D\uDD50",title:"No timeline yet",sub:"Run Full Analysis to see how the site evolved over time"})}function w({sites:e,liveAlerts:t,chatLogs:i,loading:a,apiKey:o,onAlert:s,onChat:l}){let[d,c]=(0,r.useState)(null),p=(0,r.useMemo)(()=>Object.keys(e).map((t,i)=>({id:`feed_${t}`,name:`Camera ${i+1}`,siteId:t,frame:e[t][e[t].length-1]})),[e]);return p.length?(0,n.jsxs)("div",{style:B.liveLayout,children:[n.jsx("div",{style:B.feedGrid,children:p.map(e=>n.jsx(S,{feed:e,alerts:t[e.id]||[],selected:d?.id===e.id,onSelect:()=>c(e),apiKey:o,onAlert:t=>s(e.id,t)},e.id))}),d&&n.jsx(k,{feed:d,log:i[d.id]||[],onSend:e=>l(d.id,{from:"Manager",text:e,time:new Date().toLocaleTimeString()}),onClose:()=>c(null)})]}):n.jsx(R,{icon:"\uD83D\uDCF9",title:"No feeds available",sub:"Upload footage in Review mode first — sites will appear here as simulated live cameras"})}function S({feed:e,alerts:t,selected:i,onSelect:d,apiKey:c,onAlert:p}){let[u,f]=(0,r.useState)(!1),[g,m]=(0,r.useState)(!1),h=t[t.length-1],x=(0,r.useCallback)(async()=>{if(c&&!u&&e.frame){f(!0);try{let t=await s(c,[l(e.frame.imageData,o.zoneDecomposition+"\n\n"+o.briefing)],512);p({text:t,time:new Date().toLocaleTimeString()})}catch(e){console.error(e)}finally{f(!1)}}},[c,u,e]);return(0,n.jsxs)("div",{style:{...B.feedCard,...i?B.feedCardOn:{}},onClick:d,children:[(0,n.jsxs)("div",{style:B.feedHead,children:[(0,n.jsxs)("span",{style:B.feedLabel,children:[e.name," — ",e.siteId]}),(0,n.jsxs)("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[t.length>0&&n.jsx("span",{style:B.alertDot,children:t.length}),u&&n.jsx("span",{style:B.liveBadge,children:"SCANNING"})]})]}),e.frame?n.jsx("img",{src:e.frame.imageData,style:B.feedImg,alt:e.siteId}):n.jsx("div",{style:B.feedNoImg,children:"No image"}),h&&(0,n.jsxs)("div",{style:B.feedAlert,children:[n.jsx("span",{style:B.feedAlertTime,children:h.time}),(0,n.jsxs)("span",{style:B.feedAlertText,children:[h.text.slice(0,90),"…"]})]}),c&&(0,n.jsxs)("div",{style:B.feedActions,onClick:e=>e.stopPropagation(),children:[n.jsx("button",{style:B.scanBtn,onClick:x,disabled:u||!e.frame,children:u?"Scanning…":"Scan Now"}),n.jsx("button",{style:{...B.scanBtn,color:g?a.green:a.muted},onClick:()=>m(e=>!e),children:g?"⏸ Auto":"▶ Auto (30s)"})]})]})}function k({feed:e,log:t,onSend:i,onClose:a}){let[o,s]=(0,r.useState)(""),l=(0,r.useRef)(),d=()=>{o.trim()&&(i(o.trim()),s(""))};return(0,n.jsxs)("div",{style:B.comms,children:[(0,n.jsxs)("div",{style:B.commsHead,children:[(0,n.jsxs)("span",{children:["Comms — ",e.name]}),n.jsx("button",{style:B.closeBtn,onClick:a,children:"✕"})]}),(0,n.jsxs)("div",{style:B.commsStatus,children:[n.jsx("span",{style:B.dot}),"Worker available"]}),(0,n.jsxs)("div",{ref:l,style:B.chatLog,children:[0===t.length&&n.jsx("div",{style:B.chatEmpty,children:"No messages. Type below to reach the worker."}),t.map((e,t)=>(0,n.jsxs)("div",{style:B.chatMsg,children:[(0,n.jsxs)("div",{style:B.chatMeta,children:[n.jsx("span",{style:B.chatFrom,children:e.from}),n.jsx("span",{style:B.chatTime,children:e.time})]}),n.jsx("div",{style:B.chatText,children:e.text})]},t))]}),(0,n.jsxs)("div",{style:B.chatFooter,children:[n.jsx("input",{style:B.chatInput,value:o,onChange:e=>s(e.target.value),onKeyDown:e=>"Enter"===e.key&&d(),placeholder:"Message worker…"}),n.jsx(T,{onClick:d,children:"Send"})]})]})}function C({experiments:e}){let t=e.filter(e=>"baseline"===e.type),i=e.filter(e=>"technique"===e.type),r={};e.forEach(e=>{r[e.frameId]||(r[e.frameId]={}),r[e.frameId][e.type]=e});let o=Object.values(r).filter(e=>e.baseline||e.technique);return(0,n.jsxs)("div",{style:B.expWrap,children:[(0,n.jsxs)("div",{style:B.expHeader,children:[n.jsx("div",{style:B.sectionTitle,children:"Experiment Log"}),(0,n.jsxs)("div",{style:B.expStats,children:[t.length," baseline \xb7 ",i.length," technique runs"]})]}),0===e.length&&n.jsx(R,{icon:"\uD83D\uDD2C",title:"No experiments yet",sub:"Open a site → select a frame → click 'Run Baseline' or 'Run Technique' to populate this log"}),o.length>0&&(0,n.jsxs)("div",{style:B.expTable,children:[(0,n.jsxs)("div",{style:B.expTableHead,children:[n.jsx("div",{children:"Frame"}),n.jsx("div",{children:"Baseline — naive prompt"}),n.jsx("div",{children:"Technique — spatial chain"})]}),o.map((e,t)=>{let i=e.baseline||e.technique;return(0,n.jsxs)("div",{style:B.expRow,children:[(0,n.jsxs)("div",{style:B.expRowThumbCol,children:[n.jsx("img",{src:i.thumb,style:B.expThumb,alt:""}),n.jsx("div",{style:B.expFilename,children:i.filename})]}),n.jsx("div",{style:{...B.expRowCell,color:a.muted},children:e.baseline?e.baseline.response:n.jsx("i",{children:"Not run"})}),n.jsx("div",{style:B.expRowCell,children:e.technique?e.technique.response:n.jsx("i",{style:{color:a.muted},children:"Not run"})})]},t)})]}),i.length>0&&(0,n.jsxs)("div",{style:{marginTop:32},children:[n.jsx("div",{style:B.expSubTitle,children:"Full Technique Analyses"}),i.map((e,t)=>(0,n.jsxs)("div",{style:B.expCard,children:[n.jsx("img",{src:e.thumb,style:B.expCardThumb,alt:""}),(0,n.jsxs)("div",{style:{flex:1},children:[(0,n.jsxs)("div",{style:B.expCardMeta,children:[e.filename," \xb7 ",new Date(e.ts).toLocaleString()]}),e.fullAnalysis&&(0,n.jsxs)(n.Fragment,{children:[n.jsx(D,{title:"Zone Analysis",content:e.fullAnalysis.zoneAnalysis}),n.jsx("div",{style:{marginTop:8},children:n.jsx(D,{title:"Manager Briefing",content:e.fullAnalysis.briefing,accent:a.orange})})]})]})]},t))]})]})}function D({title:e,content:t,accent:i}){return(0,n.jsxs)("div",{style:{...B.section,...i?{borderColor:i,background:`${i}0d`}:{}},children:[n.jsx("div",{style:{...B.sectionLabel,...i?{color:i}:{}},children:e}),n.jsx("div",{style:B.sectionContent,children:t})]})}function T({children:e,onClick:t,disabled:i,secondary:r}){return n.jsx("button",{style:{...r?B.btnSec:B.btnPri},onClick:t,disabled:i,children:e})}function I(){return n.jsx("div",{style:B.spinner})}function z({text:e}){return(0,n.jsxs)("div",{style:B.loader,children:[n.jsx(I,{}),n.jsx("div",{style:{color:a.muted,fontSize:14},children:e})]})}function R({icon:e,title:t,sub:i}){return(0,n.jsxs)("div",{style:B.empty,children:[e&&n.jsx("div",{style:B.emptyIcon,children:e}),t&&n.jsx("div",{style:B.emptyTitle,children:t}),i&&n.jsx("div",{style:B.emptySub,children:i})]})}let B={app:{minHeight:"100vh",background:a.bg,color:a.text,display:"flex",flexDirection:"column"},nav:{display:"flex",alignItems:"center",gap:20,padding:"12px 24px",background:a.surface,borderBottom:`1px solid ${a.border}`,flexShrink:0},navBrand:{display:"flex",alignItems:"center"},navTitle:{fontSize:17,fontWeight:700,letterSpacing:"-0.4px"},navTabs:{display:"flex",gap:4,flex:1,justifyContent:"center"},navTab:{padding:"7px 18px",background:"transparent",border:`1px solid ${a.border}`,borderRadius:8,color:a.muted,cursor:"pointer",fontSize:14,fontWeight:500},navTabOn:{background:a.orange,borderColor:a.orange,color:"#fff"},navKey:{display:"flex",alignItems:"center",gap:8},keyWrap:{position:"relative",display:"flex",alignItems:"center"},keyInput:{padding:"8px 36px 8px 12px",background:a.surface2,border:`1px solid ${a.border}`,borderRadius:8,color:a.text,fontSize:13,width:230,outline:"none"},keyEye:{position:"absolute",right:8,background:"transparent",border:"none",cursor:"pointer",fontSize:15},reviewWrap:{flex:1,padding:24,display:"flex",flexDirection:"column",gap:24,overflowY:"auto"},dropzone:{border:`2px dashed ${a.border}`,borderRadius:12,padding:"28px 24px",textAlign:"center",cursor:"pointer",background:a.surface,transition:"all 0.15s"},dropzoneDrag:{borderColor:a.orange,background:`${a.orange}12`},ingestState:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},ingestText:{fontSize:14,color:a.muted},dropIcon:{fontSize:28,color:a.orange,marginBottom:8},dropTitle:{fontSize:17,fontWeight:600,marginBottom:6},dropSub:{fontSize:13,color:a.muted},siteGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:18},siteCard:{background:a.surface,borderRadius:12,border:`2px solid ${a.border}`,overflow:"hidden",cursor:"pointer",transition:"transform 0.1s",animation:"fadein 0.2s ease"},cardThumbWrap:{position:"relative",aspectRatio:"16/9",overflow:"hidden"},cardThumb:{width:"100%",height:"100%",objectFit:"cover",display:"block"},cardBadge:{position:"absolute",top:8,right:8,padding:"3px 10px",borderRadius:6,fontSize:11,fontWeight:700,color:"#fff"},cardFrameCount:{position:"absolute",bottom:6,left:8,fontSize:11,color:"rgba(255,255,255,0.7)",background:"rgba(0,0,0,0.5)",padding:"2px 7px",borderRadius:4},cardNoThumb:{aspectRatio:"16/9",display:"flex",alignItems:"center",justifyContent:"center",background:a.surface2,color:a.muted,fontSize:13},cardBody:{padding:16},cardTitle:{fontSize:17,fontWeight:700,marginBottom:6},cardBriefPreview:{fontSize:13,color:a.muted,lineHeight:1.55,marginBottom:14,minHeight:40},cardActions:{display:"flex",gap:8},detail:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",animation:"fadein 0.2s ease"},detailHeader:{display:"flex",alignItems:"center",gap:14,padding:"14px 24px",background:a.surface,borderBottom:`1px solid ${a.border}`,flexShrink:0},backBtn:{padding:"7px 14px",background:"transparent",border:`1px solid ${a.border}`,borderRadius:8,color:a.muted,cursor:"pointer",fontSize:13},detailTitle:{fontSize:20,fontWeight:700},detailMeta:{fontSize:13,color:a.muted},tabs:{display:"flex",background:a.surface,borderBottom:`1px solid ${a.border}`,flexShrink:0},tab:{padding:"11px 20px",background:"transparent",border:"none",borderBottom:"2px solid transparent",color:a.muted,cursor:"pointer",fontSize:14,fontWeight:500},tabOn:{color:a.orange,borderBottomColor:a.orange},detailBody:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},briefingWrap:{flex:1,overflowY:"auto",padding:32,display:"flex",justifyContent:"center",alignItems:"flex-start"},briefingCard:{background:a.surface,borderRadius:16,border:`2px solid ${a.border}`,padding:32,maxWidth:660,width:"100%"},briefingTop:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},briefingBadge:{fontSize:11,fontWeight:700,letterSpacing:2},briefingTs:{fontSize:12,color:a.muted},briefingText:{fontSize:18,lineHeight:1.75},framesLayout:{flex:1,display:"grid",gridTemplateColumns:"196px 1fr",overflow:"hidden"},frameList:{borderRight:`1px solid ${a.border}`,overflowY:"auto",padding:10,display:"flex",flexDirection:"column",gap:6},frameItem:{borderRadius:8,overflow:"hidden",cursor:"pointer",border:"2px solid transparent",position:"relative"},frameItemOn:{borderColor:a.orange},frameItemThumb:{width:"100%",aspectRatio:"16/9",objectFit:"cover",display:"block"},frameItemName:{fontSize:10,color:a.muted,padding:"3px 6px",background:a.surface2,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},frameItemDone:{position:"absolute",top:4,right:4,background:a.green,color:"#fff",borderRadius:"50%",width:18,height:18,display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:700},frameMain:{padding:24,overflowY:"auto",display:"flex",flexDirection:"column",gap:16},frameImg:{width:"100%",borderRadius:10,display:"block"},frameActions:{display:"flex",gap:10},section:{background:a.surface,borderRadius:10,padding:"14px 16px",border:`1px solid ${a.border}`},sectionLabel:{fontSize:10,fontWeight:700,letterSpacing:1.5,color:a.muted,textTransform:"uppercase",marginBottom:8},sectionContent:{fontSize:14,lineHeight:1.65,whiteSpace:"pre-wrap"},timeline:{flex:1,overflowY:"auto",padding:24,display:"flex",flexDirection:"column"},tlItem:{display:"flex",gap:16},tlStep:{display:"flex",flexDirection:"column",alignItems:"center",flexShrink:0},tlNum:{width:30,height:30,background:a.orange,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:13,fontWeight:700,flexShrink:0},tlLine:{width:2,flex:1,background:a.border,margin:"6px 0",minHeight:32},tlContent:{display:"flex",gap:14,paddingBottom:28,flex:1},tlThumb:{width:112,height:63,objectFit:"cover",borderRadius:8,flexShrink:0},tlText:{flex:1},tlFile:{fontSize:11,color:a.muted,marginBottom:6},tlBrief:{fontSize:14,lineHeight:1.6,marginBottom:8},tlDelta:{fontSize:13,color:a.muted,lineHeight:1.5},liveLayout:{flex:1,display:"grid",gridTemplateColumns:"1fr 340px",overflow:"hidden"},feedGrid:{padding:20,display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(260px, 1fr))",gap:14,overflowY:"auto",alignContent:"start"},feedCard:{background:a.surface,borderRadius:12,border:`2px solid ${a.border}`,overflow:"hidden",cursor:"pointer",transition:"border-color 0.15s"},feedCardOn:{borderColor:a.orange},feedHead:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"9px 12px",background:a.surface2},feedLabel:{fontSize:13,fontWeight:600},alertDot:{background:a.red,color:"#fff",borderRadius:"50%",minWidth:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,fontWeight:700,padding:"0 4px"},liveBadge:{fontSize:10,fontWeight:700,color:a.yellow,letterSpacing:1,animation:"pulse 1s infinite"},feedImg:{width:"100%",aspectRatio:"16/9",objectFit:"cover",display:"block"},feedNoImg:{aspectRatio:"16/9",display:"flex",alignItems:"center",justifyContent:"center",background:a.surface2,color:a.muted,fontSize:13},feedAlert:{padding:"7px 12px",background:`${a.red}18`,borderTop:`1px solid ${a.red}40`},feedAlertTime:{fontSize:10,color:a.muted,marginRight:6},feedAlertText:{fontSize:12},feedActions:{display:"flex",borderTop:`1px solid ${a.border}`},scanBtn:{flex:1,padding:"8px 4px",background:"transparent",border:"none",borderRight:`1px solid ${a.border}`,color:a.orange,cursor:"pointer",fontSize:12,fontWeight:600},comms:{background:a.surface,borderLeft:`1px solid ${a.border}`,display:"flex",flexDirection:"column",overflow:"hidden"},commsHead:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"14px 18px",borderBottom:`1px solid ${a.border}`,fontWeight:700,fontSize:15},closeBtn:{background:"transparent",border:"none",color:a.muted,cursor:"pointer",fontSize:18},commsStatus:{padding:"8px 18px",borderBottom:`1px solid ${a.border}`,fontSize:13,color:a.green,display:"flex",alignItems:"center",gap:8},dot:{width:8,height:8,borderRadius:"50%",background:a.green,display:"inline-block"},chatLog:{flex:1,padding:16,overflowY:"auto",display:"flex",flexDirection:"column",gap:12},chatEmpty:{fontSize:13,color:a.muted,textAlign:"center",marginTop:24},chatMsg:{display:"flex",flexDirection:"column",gap:3},chatMeta:{display:"flex",alignItems:"center",gap:8},chatFrom:{fontSize:11,fontWeight:700,color:a.orange},chatTime:{fontSize:11,color:a.muted},chatText:{fontSize:14,lineHeight:1.5},chatFooter:{padding:14,borderTop:`1px solid ${a.border}`,display:"flex",gap:8},chatInput:{flex:1,padding:"9px 12px",background:a.surface2,border:`1px solid ${a.border}`,borderRadius:8,color:a.text,fontSize:14,outline:"none"},expWrap:{flex:1,padding:28,overflowY:"auto",display:"flex",flexDirection:"column",gap:28},expHeader:{display:"flex",justifyContent:"space-between",alignItems:"center"},sectionTitle:{fontSize:22,fontWeight:700},expStats:{fontSize:14,color:a.muted},expTable:{borderRadius:12,overflow:"hidden",border:`1px solid ${a.border}`},expTableHead:{display:"grid",gridTemplateColumns:"150px 1fr 1fr",gap:16,padding:"10px 16px",background:a.surface2,fontSize:11,fontWeight:700,letterSpacing:1,textTransform:"uppercase",color:a.muted},expRow:{display:"grid",gridTemplateColumns:"150px 1fr 1fr",gap:16,padding:"14px 16px",borderTop:`1px solid ${a.border}`,background:a.surface,fontSize:13,lineHeight:1.6},expRowThumbCol:{},expThumb:{width:"100%",borderRadius:6,marginBottom:6},expFilename:{fontSize:11,color:a.muted},expRowCell:{},expSubTitle:{fontSize:15,fontWeight:600,color:a.muted,marginBottom:12},expCard:{display:"flex",gap:16,background:a.surface,borderRadius:12,border:`1px solid ${a.border}`,padding:16,marginBottom:12},expCardThumb:{width:110,height:62,objectFit:"cover",borderRadius:8,flexShrink:0},expCardMeta:{fontSize:12,color:a.muted,marginBottom:10},btnPri:{padding:"8px 18px",background:a.orange,border:"none",borderRadius:8,color:"#fff",cursor:"pointer",fontSize:14,fontWeight:600,whiteSpace:"nowrap"},btnSec:{padding:"8px 18px",background:"transparent",border:`1px solid ${a.border}`,borderRadius:8,color:a.text,cursor:"pointer",fontSize:14,fontWeight:500,whiteSpace:"nowrap"},spinner:{width:28,height:28,border:`3px solid ${a.border}`,borderTop:`3px solid ${a.orange}`,borderRadius:"50%",animation:"spin 0.7s linear infinite"},loader:{display:"flex",flexDirection:"column",alignItems:"center",gap:14,padding:48},empty:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:12,padding:"60px 40px",textAlign:"center"},emptyIcon:{fontSize:48,marginBottom:4},emptyTitle:{fontSize:20,fontWeight:700},emptySub:{fontSize:14,color:a.muted,maxWidth:380,lineHeight:1.6}},$=function(){let[e,t]=(0,r.useState)(""),[i,a]=(0,r.useState)("review"),[u,h]=(0,r.useState)([]),[x,y]=(0,r.useState)({}),[b,v]=(0,r.useState)({}),[j,S]=(0,r.useState)({}),[k,D]=(0,r.useState)([]),[T,I]=(0,r.useState)(null),[z,R]=(0,r.useState)({}),[$,A]=(0,r.useState)(!1),[W,P]=(0,r.useState)(null),[L,M]=(0,r.useState)({}),[F,_]=(0,r.useState)({}),[N,O]=(0,r.useState)(null),E=(0,r.useMemo)(()=>{let e={};return u.forEach(t=>{e[t.siteId]||(e[t.siteId]=[]),e[t.siteId].push(t)}),Object.keys(e).forEach(t=>e[t].sort((e,t)=>e.timestamp-t.timestamp)),e},[u]),q=e=>R(t=>({...t,[e]:!0})),H=e=>R(t=>{let i={...t};return delete i[e],i}),U=async e=>{A(!0);let t=[];for(let i of Array.from(e)){let e=i.name.split(".").pop().toLowerCase();if(["mp4","mov","webm","avi","mkv"].includes(e)){P({file:i.name,cur:0,tot:"?"});let e=await c(i,5,(e,t)=>P({file:i.name,cur:e,tot:t}));t.push(...e)}else["jpg","jpeg","png","webp","gif"].includes(e)&&(t.push(await p(i)),P({file:i.name,cur:1,tot:1}))}h(e=>[...e,...t]),A(!1),P(null)},G=async t=>{let i=`bl_${t.id}`;q(i);try{let i=await s(e,[l(t.imageData,o.baseline)]);return D(e=>[...e,{id:Date.now(),type:"baseline",frameId:t.id,thumb:t.imageData,filename:t.filename,prompt:o.baseline,response:i,ts:new Date().toISOString()}]),i}catch(e){O(e.message)}finally{H(i)}},K=async(t,i=null)=>{let n=`tc_${t.id}`;q(n);try{let n=await d(e,t,i);return y(e=>({...e,[t.id]:n})),D(e=>[...e,{id:Date.now(),type:"technique",frameId:t.id,thumb:t.imageData,filename:t.filename,prompt:"Zone + Relationship + Briefing chain",response:n.briefing,fullAnalysis:n,ts:n.ts}]),n}catch(e){O(e.message)}finally{H(n)}},Y=async t=>{let i=(E[t]||[]).slice(0,6);if(i.length){q(`chain_${t}`);try{let n=[],r=null;for(let t of i){let i=await d(e,t,r);y(e=>({...e,[t.id]:i})),n.push({frame:t,analysis:i}),r=`${i.zoneAnalysis}

${i.relationships}`}let a=n.map((e,t)=>`Time ${t+1}:
${e.analysis.briefing}`).join("\n\n---\n\n"),l=await s(e,[{role:"user",content:`Across ${n.length} time periods on this construction site:

${a}

${o.briefing}`}],512);v(e=>({...e,[t]:{text:l,ts:new Date().toISOString()}})),S(e=>({...e,[t]:n}))}finally{H(`chain_${t}`)}}};return(0,n.jsxs)("div",{style:B.app,children:[n.jsx(g,{apiKey:e,onKey:t,mode:i,onMode:a}),"review"===i&&n.jsx(m,{sites:E,analyses:x,siteBriefs:b,chains:j,loading:z,ingesting:$,ingestProg:W,selectedSite:T,onSelectSite:I,onIngest:U,onRunBaseline:G,onRunTechnique:K,onRunChain:Y,siteAlertLevel:e=>f(b[e]?.text),apiKey:e}),"live"===i&&n.jsx(w,{sites:E,liveAlerts:L,chatLogs:F,loading:z,apiKey:e,onAlert:(e,t)=>M(i=>({...i,[e]:[...i[e]||[],t]})),onChat:(e,t)=>_(i=>({...i,[e]:[...i[e]||[],t]}))}),"experiments"===i&&n.jsx(C,{experiments:k,loading:z})]})}},7764:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a,metadata:()=>r});var n=i(9510);i(7272);let r={title:"IronSite Manager",description:"IronSite Manager"};function a({children:e}){return(0,n.jsxs)("html",{lang:"en",children:[(0,n.jsxs)("head",{children:[n.jsx("meta",{charset:"UTF-8"}),n.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"})]}),n.jsx("body",{children:e})]})}},7288:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var n=i(9510);let r=(0,i(8570).createProxy)(String.raw`/Users/aprameyakannan/Documents/ironminer/app/App.js#default`);function a(){return n.jsx(r,{})}},7272:()=>{}};var t=require("../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),n=t.X(0,[819],()=>i(675));module.exports=n})();