(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4613:function(e,t,n){Promise.resolve().then(n.bind(n,2770))},2770:function(e,t,n){"use strict";var i=n(7437),r=n(2265);let o={bg:"#0f172a",surface:"#1e293b",surface2:"#273449",border:"#334155",text:"#f1f5f9",muted:"#64748b",orange:"#f97316",green:"#22c55e",yellow:"#facc15",red:"#ef4444",blue:"#60a5fa"},a={baseline:"Describe what is happening in this construction site image.",zoneDecomposition:"Divide this construction site image into spatial zones (foreground/midground/background, left/center/right, ground level/elevated). For each zone describe: what trade or activity is present, how many workers, what equipment and materials occupy the space, and how crowded the zone is on a 1–5 scale (1=empty, 5=severely congested). Use clear zone headers. Be specific about locations.",entityRelationship:"Based on this construction site image and the zone analysis above, describe the spatial relationships: which trades are working adjacent to each other, where are movement corridors blocked or narrow, where is equipment creating clearance issues, and which zones have multiple trades competing for the same space. Be specific about locations and consequences.",temporal:(e,t)=>"Previous site analysis (".concat(t,"):\n").concat(e,"\n\n")+"Now compare against the current frame. What has changed spatially? Have congestion hotspots shifted? Have new trade overlaps appeared? Has any area cleared? Rate the overall congestion trend: improving, stable, or worsening. Be specific about what changed and where.",briefing:"Summarize the spatial analysis as a briefing for a non-technical construction site manager. Plain language only — no jargon. Lead with the single most important issue. Keep it under 150 words. End with one specific, actionable recommendation a manager can act on right now."};async function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1024,i=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"x-api-key":e,"anthropic-version":"2023-06-01","content-type":"application/json","anthropic-dangerous-direct-browser-access":"true"},body:JSON.stringify({model:"claude-sonnet-4-6",max_tokens:n,messages:t})});if(!i.ok){var r;throw Error((null===(r=(await i.json().catch(()=>({}))).error)||void 0===r?void 0:r.message)||"API error ".concat(i.status))}return(await i.json()).content[0].text}function s(e,t){let n="image/jpeg",i=e;if(e.startsWith("data:")){let t=e.match(/^data:([^;]+);base64,(.+)$/);t&&(n=t[1],i=t[2])}return{role:"user",content:[{type:"image",source:{type:"base64",media_type:n,data:i}},{type:"text",text:t}]}}async function d(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=await l(e,[s(t.imageData,a.zoneDecomposition)],1024),r=await l(e,[s(t.imageData,a.zoneDecomposition),{role:"assistant",content:i},{role:"user",content:a.entityRelationship}],1024),o=null;n&&(o=await l(e,[s(t.imageData,a.temporal(n,"previous frame"))],768));let d=["Zone Analysis:\n".concat(i),"Spatial Relationships:\n".concat(r),o?"Temporal Changes:\n".concat(o):""].filter(Boolean).join("\n\n---\n\n");return{zoneAnalysis:i,relationships:r,temporal:o,briefing:await l(e,[{role:"user",content:"".concat(d,"\n\n---\n\n").concat(a.briefing)}],512),ts:new Date().toISOString()}}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2?arguments[2]:void 0;return new Promise((i,r)=>{let o=document.createElement("video"),a=document.createElement("canvas"),l=a.getContext("2d"),s=[];o.onloadedmetadata=()=>{a.width=Math.min(o.videoWidth,960),a.height=Math.round(a.width*o.videoHeight/o.videoWidth);let r=[];for(let e=0;e<o.duration;e+=t)r.push(e);let d=0,c=()=>{if(d>=r.length){URL.revokeObjectURL(o.src),i(s);return}o.currentTime=r[d]};o.onseeked=()=>{l.drawImage(o,0,0,a.width,a.height),s.push({id:"v".concat(Date.now(),"_").concat(d),siteId:u(e.name),timestamp:r[d],imageData:a.toDataURL("image/jpeg",.82),filename:"".concat(e.name," @").concat(Math.round(r[d]),"s")}),null==n||n(d+1,r.length),d++,c()},c()},o.onerror=r,o.src=URL.createObjectURL(e)})}async function p(e){return new Promise((t,n)=>{let i=new FileReader;i.onload=n=>{let i=e.name.match(/(\d{10,13})/);t({id:"i".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2,7)),siteId:u(e.name),timestamp:i?parseInt(i[1]):Date.now(),imageData:n.target.result,filename:e.name})},i.onerror=n,i.readAsDataURL(e)})}function u(e){for(let t of[/^(site[-_]\w+)/i,/^([A-Z]\d{3,})/i,/^(\w+?)[-_.]/]){let n=e.match(t);if(n)return n[1].toUpperCase().slice(0,12)}return e.replace(/\.[^.]+$/,"").slice(0,8).toUpperCase()||"SITE-01"}function f(e){if(!e)return"none";let t=e.toLowerCase();return t.includes("critical")||t.includes("danger")||t.includes("immediate")||t.includes("unsafe")?"critical":t.includes("congest")||t.includes("block")||t.includes("overlap")||t.includes("crowd")||t.includes("risk")?"warning":"ok"}function g(e){let{apiKey:t,onKey:n,mode:a,onMode:l}=e,[s,d]=(0,r.useState)(!1);return(0,i.jsxs)("div",{style:B.nav,children:[(0,i.jsxs)("div",{style:B.navBrand,children:[(0,i.jsxs)("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",style:{marginRight:8},children:[(0,i.jsx)("polygon",{points:"12,2 22,8 22,16 12,22 2,16 2,8",stroke:o.orange,strokeWidth:"2",fill:"none"}),(0,i.jsx)("polygon",{points:"12,7 17,10 17,14 12,17 7,14 7,10",fill:o.orange,opacity:"0.6"})]}),(0,i.jsx)("span",{style:B.navTitle,children:"IronSite Manager"})]}),(0,i.jsx)("div",{style:B.navTabs,children:[["review","Review"],["live","Live"],["experiments","Experiments"]].map(e=>{let[t,n]=e;return(0,i.jsx)("button",{style:{...B.navTab,...a===t?B.navTabOn:{}},onClick:()=>l(t),children:n},t)})}),(0,i.jsxs)("div",{style:B.navKey,children:[(0,i.jsxs)("div",{style:B.keyWrap,children:[(0,i.jsx)("input",{type:s?"text":"password",placeholder:"sk-ant-... API key",value:t,onChange:e=>n(e.target.value),style:B.keyInput}),(0,i.jsx)("button",{style:B.keyEye,onClick:()=>d(e=>!e),children:s?"\uD83D\uDE48":"\uD83D\uDC41"})]}),t&&(0,i.jsx)("span",{style:{color:o.green,fontSize:18},children:"●"})]})]})}function m(e){let{sites:t,analyses:n,siteBriefs:o,chains:a,loading:l,ingesting:s,ingestProg:d,selectedSite:c,onSelectSite:p,onIngest:u,onRunBaseline:f,onRunTechnique:g,onRunChain:m,siteAlertLevel:b,apiKey:v}=e,j=(0,r.useMemo)(()=>Object.keys(t).sort((e,t)=>{let n={critical:3,warning:2,ok:1,none:0};return n[b(t)]-n[b(e)]}),[t,o]);return c?(0,i.jsx)(y,{siteId:c,frames:t[c]||[],analyses:n,briefing:o[c],chain:a[c],loading:l,onBack:()=>p(null),onRunBaseline:f,onRunTechnique:g,onRunChain:()=>m(c),apiKey:v}):(0,i.jsxs)("div",{style:B.reviewWrap,children:[(0,i.jsx)(h,{onIngest:u,ingesting:s,prog:d}),0===j.length&&!s&&(0,i.jsx)(R,{icon:"\uD83C\uDFD7",title:"No sites loaded",sub:"Drop footage above — videos or image sequences accepted"}),j.length>0&&(0,i.jsx)("div",{style:B.siteGrid,children:j.map(e=>(0,i.jsx)(x,{siteId:e,frames:t[e],briefing:o[e],level:b(e),busy:!!l["chain_".concat(e)],onOpen:()=>p(e),onAnalyze:()=>m(e),hasKey:!!v},e))})]})}function h(e){let{onIngest:t,ingesting:n,prog:o}=e,a=(0,r.useRef)(),[l,s]=(0,r.useState)(!1);return(0,i.jsxs)("div",{style:{...B.dropzone,...l?B.dropzoneDrag:{}},onDragOver:e=>{e.preventDefault(),s(!0)},onDragLeave:()=>s(!1),onDrop:e=>{e.preventDefault(),s(!1),t(e.dataTransfer.files)},onClick:()=>!n&&a.current.click(),children:[(0,i.jsx)("input",{ref:a,type:"file",multiple:!0,accept:"video/*,image/*",style:{display:"none"},onChange:e=>t(e.target.files)}),n?(0,i.jsxs)("div",{style:B.ingestState,children:[(0,i.jsx)(I,{}),o&&(0,i.jsxs)("div",{style:B.ingestText,children:["Extracting ",o.file," — frame ",o.cur," of ",o.tot]})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{style:B.dropIcon,children:"↑"}),(0,i.jsx)("div",{style:B.dropTitle,children:"Drop footage here"}),(0,i.jsx)("div",{style:B.dropSub,children:"MP4 \xb7 MOV \xb7 WEBM \xb7 JPG \xb7 PNG — click to browse"})]})]})}function x(e){var t;let{siteId:n,frames:r,briefing:a,level:l,busy:s,onOpen:d,onAnalyze:c,hasKey:p}=e,u={critical:o.red,warning:o.orange,ok:o.green,none:o.border},f=null===(t=r[0])||void 0===t?void 0:t.imageData;return(0,i.jsxs)("div",{style:{...B.siteCard,borderColor:u[l]},onClick:d,children:[f?(0,i.jsxs)("div",{style:B.cardThumbWrap,children:[(0,i.jsx)("img",{src:f,style:B.cardThumb,alt:n}),"none"!==l&&(0,i.jsx)("div",{style:{...B.cardBadge,background:u[l]},children:{critical:"⚠ CRITICAL",warning:"! CONGESTION",ok:"✓ CLEAR",none:""}[l]}),(0,i.jsxs)("div",{style:B.cardFrameCount,children:[r.length," frames"]})]}):(0,i.jsx)("div",{style:B.cardNoThumb,children:"No frames"}),(0,i.jsxs)("div",{style:B.cardBody,children:[(0,i.jsx)("div",{style:B.cardTitle,children:n}),a?(0,i.jsxs)("div",{style:B.cardBriefPreview,children:[a.text.slice(0,110),"…"]}):(0,i.jsx)("div",{style:{...B.cardBriefPreview,color:o.muted,fontStyle:"italic"},children:"Not yet analyzed"}),(0,i.jsxs)("div",{style:B.cardActions,onClick:e=>e.stopPropagation(),children:[(0,i.jsx)(D,{onClick:d,children:"View →"}),p&&!a&&(0,i.jsx)(D,{secondary:!0,onClick:c,disabled:s,children:s?"Analyzing…":"Analyze Site"})]})]})]})}function y(e){let{siteId:t,frames:n,analyses:o,briefing:a,chain:l,loading:s,onBack:d,onRunBaseline:c,onRunTechnique:p,onRunChain:u,apiKey:f}=e,[g,m]=(0,r.useState)("briefing"),[h,x]=(0,r.useState)(n[0]||null),y=!!s["chain_".concat(t)];return(0,i.jsxs)("div",{style:B.detail,children:[(0,i.jsxs)("div",{style:B.detailHeader,children:[(0,i.jsx)("button",{style:B.backBtn,onClick:d,children:"← Back"}),(0,i.jsx)("div",{style:B.detailTitle,children:t}),(0,i.jsxs)("div",{style:B.detailMeta,children:[n.length," frames"]}),(0,i.jsx)("div",{style:{flex:1}}),f&&(0,i.jsx)(D,{onClick:u,disabled:y,children:y?"Analyzing…":"▶ Run Full Analysis"})]}),(0,i.jsx)("div",{style:B.tabs,children:[["briefing","Manager Briefing"],["frames","Frame Analysis"],["timeline","Timeline"]].map(e=>{let[t,n]=e;return(0,i.jsx)("button",{style:{...B.tab,...g===t?B.tabOn:{}},onClick:()=>m(t),children:n},t)})}),(0,i.jsxs)("div",{style:B.detailBody,children:["briefing"===g&&(0,i.jsx)(b,{briefing:a,busy:y}),"frames"===g&&(0,i.jsx)(v,{frames:n,analyses:o,selFrame:h,onSel:x,loading:s,onBaseline:c,onTechnique:p,apiKey:f}),"timeline"===g&&(0,i.jsx)(j,{chain:l,busy:y})]})]})}function b(e){let{briefing:t,busy:n}=e;if(n)return(0,i.jsx)(z,{text:"Running spatial analysis chain…"});if(!t)return(0,i.jsx)(R,{icon:"\uD83D\uDCCB",title:"No briefing yet",sub:"Click 'Run Full Analysis' to generate a site briefing"});let r=f(t.text),a={critical:o.red,warning:o.orange,ok:o.green,none:o.blue}[r];return(0,i.jsx)("div",{style:B.briefingWrap,children:(0,i.jsxs)("div",{style:{...B.briefingCard,borderColor:a},children:[(0,i.jsxs)("div",{style:B.briefingTop,children:[(0,i.jsx)("div",{style:{...B.briefingBadge,color:a},children:"SITE BRIEFING"}),(0,i.jsx)("div",{style:B.briefingTs,children:new Date(t.ts).toLocaleString()})]}),(0,i.jsx)("div",{style:B.briefingText,children:t.text})]})})}function v(e){let{frames:t,analyses:n,selFrame:r,onSel:a,loading:l,onBaseline:s,onTechnique:d,apiKey:c}=e,p=r?n[r.id]:null,u=r&&!!l["bl_".concat(r.id)],f=r&&!!l["tc_".concat(r.id)];return(0,i.jsxs)("div",{style:B.framesLayout,children:[(0,i.jsx)("div",{style:B.frameList,children:t.map(e=>{var t;return(0,i.jsxs)("div",{style:{...B.frameItem,...(null==r?void 0:r.id)===e.id?B.frameItemOn:{}},onClick:()=>a(e),children:[(0,i.jsx)("img",{src:e.imageData,style:B.frameItemThumb,alt:e.filename}),(0,i.jsx)("div",{style:B.frameItemName,children:null===(t=e.filename)||void 0===t?void 0:t.slice(0,22)}),n[e.id]&&(0,i.jsx)("div",{style:B.frameItemDone,children:"✓"})]},e.id)})}),(0,i.jsxs)("div",{style:B.frameMain,children:[!r&&(0,i.jsx)(R,{icon:"\uD83D\uDDBC",title:"Select a frame",sub:"Choose from the list on the left"}),r&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("img",{src:r.imageData,style:B.frameImg,alt:"frame"}),c&&(0,i.jsxs)("div",{style:B.frameActions,children:[(0,i.jsx)(D,{secondary:!0,onClick:()=>s(r),disabled:u,children:u?"Running…":"Run Baseline"}),(0,i.jsx)(D,{onClick:()=>d(r),disabled:f,children:f?"Analyzing…":"▶ Run Technique"})]}),(u||f)&&(0,i.jsx)(z,{text:f?"Running 4-step spatial chain…":"Running baseline prompt…"}),p&&(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[(0,i.jsx)(T,{title:"Zone Analysis",content:p.zoneAnalysis}),(0,i.jsx)(T,{title:"Spatial Relationships",content:p.relationships}),p.temporal&&(0,i.jsx)(T,{title:"Temporal Changes",content:p.temporal,accent:o.yellow}),(0,i.jsx)(T,{title:"Manager Briefing",content:p.briefing,accent:o.orange})]})]})]})]})}function j(e){let{chain:t,busy:n}=e;return n?(0,i.jsx)(z,{text:"Running temporal chain…"}):(null==t?void 0:t.length)?(0,i.jsx)("div",{style:B.timeline,children:t.map((e,n)=>{let{frame:r,analysis:a}=e;return(0,i.jsxs)("div",{style:B.tlItem,children:[(0,i.jsxs)("div",{style:B.tlStep,children:[(0,i.jsx)("div",{style:B.tlNum,children:n+1}),n<t.length-1&&(0,i.jsx)("div",{style:B.tlLine})]}),(0,i.jsxs)("div",{style:B.tlContent,children:[(0,i.jsx)("img",{src:r.imageData,style:B.tlThumb,alt:""}),(0,i.jsxs)("div",{style:B.tlText,children:[(0,i.jsx)("div",{style:B.tlFile,children:r.filename}),(0,i.jsx)("div",{style:B.tlBrief,children:a.briefing}),a.temporal&&(0,i.jsxs)("div",{style:B.tlDelta,children:[(0,i.jsx)("span",{style:{color:o.yellow,fontWeight:600},children:"Δ Changes: "}),a.temporal.slice(0,220),"…"]})]})]})]},r.id)})}):(0,i.jsx)(R,{icon:"\uD83D\uDD50",title:"No timeline yet",sub:"Run Full Analysis to see how the site evolved over time"})}function w(e){let{sites:t,liveAlerts:n,chatLogs:o,loading:a,apiKey:l,onAlert:s,onChat:d}=e,[c,p]=(0,r.useState)(null),u=(0,r.useMemo)(()=>Object.keys(t).map((e,n)=>({id:"feed_".concat(e),name:"Camera ".concat(n+1),siteId:e,frame:t[e][t[e].length-1]})),[t]);return u.length?(0,i.jsxs)("div",{style:B.liveLayout,children:[(0,i.jsx)("div",{style:B.feedGrid,children:u.map(e=>(0,i.jsx)(S,{feed:e,alerts:n[e.id]||[],selected:(null==c?void 0:c.id)===e.id,onSelect:()=>p(e),apiKey:l,onAlert:t=>s(e.id,t)},e.id))}),c&&(0,i.jsx)(k,{feed:c,log:o[c.id]||[],onSend:e=>d(c.id,{from:"Manager",text:e,time:new Date().toLocaleTimeString()}),onClose:()=>p(null)})]}):(0,i.jsx)(R,{icon:"\uD83D\uDCF9",title:"No feeds available",sub:"Upload footage in Review mode first — sites will appear here as simulated live cameras"})}function S(e){let{feed:t,alerts:n,selected:d,onSelect:c,apiKey:p,onAlert:u}=e,[f,g]=(0,r.useState)(!1),[m,h]=(0,r.useState)(!1),x=n[n.length-1],y=(0,r.useCallback)(async()=>{if(p&&!f&&t.frame){g(!0);try{let e=await l(p,[s(t.frame.imageData,a.zoneDecomposition+"\n\n"+a.briefing)],512);u({text:e,time:new Date().toLocaleTimeString()})}catch(e){console.error(e)}finally{g(!1)}}},[p,f,t]);return(0,r.useEffect)(()=>{if(!m)return;let e=setInterval(y,3e4);return()=>clearInterval(e)},[m,y]),(0,i.jsxs)("div",{style:{...B.feedCard,...d?B.feedCardOn:{}},onClick:c,children:[(0,i.jsxs)("div",{style:B.feedHead,children:[(0,i.jsxs)("span",{style:B.feedLabel,children:[t.name," — ",t.siteId]}),(0,i.jsxs)("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[n.length>0&&(0,i.jsx)("span",{style:B.alertDot,children:n.length}),f&&(0,i.jsx)("span",{style:B.liveBadge,children:"SCANNING"})]})]}),t.frame?(0,i.jsx)("img",{src:t.frame.imageData,style:B.feedImg,alt:t.siteId}):(0,i.jsx)("div",{style:B.feedNoImg,children:"No image"}),x&&(0,i.jsxs)("div",{style:B.feedAlert,children:[(0,i.jsx)("span",{style:B.feedAlertTime,children:x.time}),(0,i.jsxs)("span",{style:B.feedAlertText,children:[x.text.slice(0,90),"…"]})]}),p&&(0,i.jsxs)("div",{style:B.feedActions,onClick:e=>e.stopPropagation(),children:[(0,i.jsx)("button",{style:B.scanBtn,onClick:y,disabled:f||!t.frame,children:f?"Scanning…":"Scan Now"}),(0,i.jsx)("button",{style:{...B.scanBtn,color:m?o.green:o.muted},onClick:()=>h(e=>!e),children:m?"⏸ Auto":"▶ Auto (30s)"})]})]})}function k(e){let{feed:t,log:n,onSend:o,onClose:a}=e,[l,s]=(0,r.useState)(""),d=(0,r.useRef)();(0,r.useEffect)(()=>{d.current&&(d.current.scrollTop=d.current.scrollHeight)},[n]);let c=()=>{l.trim()&&(o(l.trim()),s(""))};return(0,i.jsxs)("div",{style:B.comms,children:[(0,i.jsxs)("div",{style:B.commsHead,children:[(0,i.jsxs)("span",{children:["Comms — ",t.name]}),(0,i.jsx)("button",{style:B.closeBtn,onClick:a,children:"✕"})]}),(0,i.jsxs)("div",{style:B.commsStatus,children:[(0,i.jsx)("span",{style:B.dot}),"Worker available"]}),(0,i.jsxs)("div",{ref:d,style:B.chatLog,children:[0===n.length&&(0,i.jsx)("div",{style:B.chatEmpty,children:"No messages. Type below to reach the worker."}),n.map((e,t)=>(0,i.jsxs)("div",{style:B.chatMsg,children:[(0,i.jsxs)("div",{style:B.chatMeta,children:[(0,i.jsx)("span",{style:B.chatFrom,children:e.from}),(0,i.jsx)("span",{style:B.chatTime,children:e.time})]}),(0,i.jsx)("div",{style:B.chatText,children:e.text})]},t))]}),(0,i.jsxs)("div",{style:B.chatFooter,children:[(0,i.jsx)("input",{style:B.chatInput,value:l,onChange:e=>s(e.target.value),onKeyDown:e=>"Enter"===e.key&&c(),placeholder:"Message worker…"}),(0,i.jsx)(D,{onClick:c,children:"Send"})]})]})}function C(e){let{experiments:t}=e,n=t.filter(e=>"baseline"===e.type),r=t.filter(e=>"technique"===e.type),a={};t.forEach(e=>{a[e.frameId]||(a[e.frameId]={}),a[e.frameId][e.type]=e});let l=Object.values(a).filter(e=>e.baseline||e.technique);return(0,i.jsxs)("div",{style:B.expWrap,children:[(0,i.jsxs)("div",{style:B.expHeader,children:[(0,i.jsx)("div",{style:B.sectionTitle,children:"Experiment Log"}),(0,i.jsxs)("div",{style:B.expStats,children:[n.length," baseline \xb7 ",r.length," technique runs"]})]}),0===t.length&&(0,i.jsx)(R,{icon:"\uD83D\uDD2C",title:"No experiments yet",sub:"Open a site → select a frame → click 'Run Baseline' or 'Run Technique' to populate this log"}),l.length>0&&(0,i.jsxs)("div",{style:B.expTable,children:[(0,i.jsxs)("div",{style:B.expTableHead,children:[(0,i.jsx)("div",{children:"Frame"}),(0,i.jsx)("div",{children:"Baseline — naive prompt"}),(0,i.jsx)("div",{children:"Technique — spatial chain"})]}),l.map((e,t)=>{let n=e.baseline||e.technique;return(0,i.jsxs)("div",{style:B.expRow,children:[(0,i.jsxs)("div",{style:B.expRowThumbCol,children:[(0,i.jsx)("img",{src:n.thumb,style:B.expThumb,alt:""}),(0,i.jsx)("div",{style:B.expFilename,children:n.filename})]}),(0,i.jsx)("div",{style:{...B.expRowCell,color:o.muted},children:e.baseline?e.baseline.response:(0,i.jsx)("i",{children:"Not run"})}),(0,i.jsx)("div",{style:B.expRowCell,children:e.technique?e.technique.response:(0,i.jsx)("i",{style:{color:o.muted},children:"Not run"})})]},t)})]}),r.length>0&&(0,i.jsxs)("div",{style:{marginTop:32},children:[(0,i.jsx)("div",{style:B.expSubTitle,children:"Full Technique Analyses"}),r.map((e,t)=>(0,i.jsxs)("div",{style:B.expCard,children:[(0,i.jsx)("img",{src:e.thumb,style:B.expCardThumb,alt:""}),(0,i.jsxs)("div",{style:{flex:1},children:[(0,i.jsxs)("div",{style:B.expCardMeta,children:[e.filename," \xb7 ",new Date(e.ts).toLocaleString()]}),e.fullAnalysis&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(T,{title:"Zone Analysis",content:e.fullAnalysis.zoneAnalysis}),(0,i.jsx)("div",{style:{marginTop:8},children:(0,i.jsx)(T,{title:"Manager Briefing",content:e.fullAnalysis.briefing,accent:o.orange})})]})]})]},t))]})]})}function T(e){let{title:t,content:n,accent:r}=e;return(0,i.jsxs)("div",{style:{...B.section,...r?{borderColor:r,background:"".concat(r,"0d")}:{}},children:[(0,i.jsx)("div",{style:{...B.sectionLabel,...r?{color:r}:{}},children:t}),(0,i.jsx)("div",{style:B.sectionContent,children:n})]})}function D(e){let{children:t,onClick:n,disabled:r,secondary:o}=e;return(0,i.jsx)("button",{style:{...o?B.btnSec:B.btnPri},onClick:n,disabled:r,children:t})}function I(){return(0,i.jsx)("div",{style:B.spinner})}function z(e){let{text:t}=e;return(0,i.jsxs)("div",{style:B.loader,children:[(0,i.jsx)(I,{}),(0,i.jsx)("div",{style:{color:o.muted,fontSize:14},children:t})]})}function R(e){let{icon:t,title:n,sub:r}=e;return(0,i.jsxs)("div",{style:B.empty,children:[t&&(0,i.jsx)("div",{style:B.emptyIcon,children:t}),n&&(0,i.jsx)("div",{style:B.emptyTitle,children:n}),r&&(0,i.jsx)("div",{style:B.emptySub,children:r})]})}let B={app:{minHeight:"100vh",background:o.bg,color:o.text,display:"flex",flexDirection:"column"},nav:{display:"flex",alignItems:"center",gap:20,padding:"12px 24px",background:o.surface,borderBottom:"1px solid ".concat(o.border),flexShrink:0},navBrand:{display:"flex",alignItems:"center"},navTitle:{fontSize:17,fontWeight:700,letterSpacing:"-0.4px"},navTabs:{display:"flex",gap:4,flex:1,justifyContent:"center"},navTab:{padding:"7px 18px",background:"transparent",border:"1px solid ".concat(o.border),borderRadius:8,color:o.muted,cursor:"pointer",fontSize:14,fontWeight:500},navTabOn:{background:o.orange,borderColor:o.orange,color:"#fff"},navKey:{display:"flex",alignItems:"center",gap:8},keyWrap:{position:"relative",display:"flex",alignItems:"center"},keyInput:{padding:"8px 36px 8px 12px",background:o.surface2,border:"1px solid ".concat(o.border),borderRadius:8,color:o.text,fontSize:13,width:230,outline:"none"},keyEye:{position:"absolute",right:8,background:"transparent",border:"none",cursor:"pointer",fontSize:15},reviewWrap:{flex:1,padding:24,display:"flex",flexDirection:"column",gap:24,overflowY:"auto"},dropzone:{border:"2px dashed ".concat(o.border),borderRadius:12,padding:"28px 24px",textAlign:"center",cursor:"pointer",background:o.surface,transition:"all 0.15s"},dropzoneDrag:{borderColor:o.orange,background:"".concat(o.orange,"12")},ingestState:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},ingestText:{fontSize:14,color:o.muted},dropIcon:{fontSize:28,color:o.orange,marginBottom:8},dropTitle:{fontSize:17,fontWeight:600,marginBottom:6},dropSub:{fontSize:13,color:o.muted},siteGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:18},siteCard:{background:o.surface,borderRadius:12,border:"2px solid ".concat(o.border),overflow:"hidden",cursor:"pointer",transition:"transform 0.1s",animation:"fadein 0.2s ease"},cardThumbWrap:{position:"relative",aspectRatio:"16/9",overflow:"hidden"},cardThumb:{width:"100%",height:"100%",objectFit:"cover",display:"block"},cardBadge:{position:"absolute",top:8,right:8,padding:"3px 10px",borderRadius:6,fontSize:11,fontWeight:700,color:"#fff"},cardFrameCount:{position:"absolute",bottom:6,left:8,fontSize:11,color:"rgba(255,255,255,0.7)",background:"rgba(0,0,0,0.5)",padding:"2px 7px",borderRadius:4},cardNoThumb:{aspectRatio:"16/9",display:"flex",alignItems:"center",justifyContent:"center",background:o.surface2,color:o.muted,fontSize:13},cardBody:{padding:16},cardTitle:{fontSize:17,fontWeight:700,marginBottom:6},cardBriefPreview:{fontSize:13,color:o.muted,lineHeight:1.55,marginBottom:14,minHeight:40},cardActions:{display:"flex",gap:8},detail:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",animation:"fadein 0.2s ease"},detailHeader:{display:"flex",alignItems:"center",gap:14,padding:"14px 24px",background:o.surface,borderBottom:"1px solid ".concat(o.border),flexShrink:0},backBtn:{padding:"7px 14px",background:"transparent",border:"1px solid ".concat(o.border),borderRadius:8,color:o.muted,cursor:"pointer",fontSize:13},detailTitle:{fontSize:20,fontWeight:700},detailMeta:{fontSize:13,color:o.muted},tabs:{display:"flex",background:o.surface,borderBottom:"1px solid ".concat(o.border),flexShrink:0},tab:{padding:"11px 20px",background:"transparent",border:"none",borderBottom:"2px solid transparent",color:o.muted,cursor:"pointer",fontSize:14,fontWeight:500},tabOn:{color:o.orange,borderBottomColor:o.orange},detailBody:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},briefingWrap:{flex:1,overflowY:"auto",padding:32,display:"flex",justifyContent:"center",alignItems:"flex-start"},briefingCard:{background:o.surface,borderRadius:16,border:"2px solid ".concat(o.border),padding:32,maxWidth:660,width:"100%"},briefingTop:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},briefingBadge:{fontSize:11,fontWeight:700,letterSpacing:2},briefingTs:{fontSize:12,color:o.muted},briefingText:{fontSize:18,lineHeight:1.75},framesLayout:{flex:1,display:"grid",gridTemplateColumns:"196px 1fr",overflow:"hidden"},frameList:{borderRight:"1px solid ".concat(o.border),overflowY:"auto",padding:10,display:"flex",flexDirection:"column",gap:6},frameItem:{borderRadius:8,overflow:"hidden",cursor:"pointer",border:"2px solid transparent",position:"relative"},frameItemOn:{borderColor:o.orange},frameItemThumb:{width:"100%",aspectRatio:"16/9",objectFit:"cover",display:"block"},frameItemName:{fontSize:10,color:o.muted,padding:"3px 6px",background:o.surface2,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},frameItemDone:{position:"absolute",top:4,right:4,background:o.green,color:"#fff",borderRadius:"50%",width:18,height:18,display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:700},frameMain:{padding:24,overflowY:"auto",display:"flex",flexDirection:"column",gap:16},frameImg:{width:"100%",borderRadius:10,display:"block"},frameActions:{display:"flex",gap:10},section:{background:o.surface,borderRadius:10,padding:"14px 16px",border:"1px solid ".concat(o.border)},sectionLabel:{fontSize:10,fontWeight:700,letterSpacing:1.5,color:o.muted,textTransform:"uppercase",marginBottom:8},sectionContent:{fontSize:14,lineHeight:1.65,whiteSpace:"pre-wrap"},timeline:{flex:1,overflowY:"auto",padding:24,display:"flex",flexDirection:"column"},tlItem:{display:"flex",gap:16},tlStep:{display:"flex",flexDirection:"column",alignItems:"center",flexShrink:0},tlNum:{width:30,height:30,background:o.orange,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:13,fontWeight:700,flexShrink:0},tlLine:{width:2,flex:1,background:o.border,margin:"6px 0",minHeight:32},tlContent:{display:"flex",gap:14,paddingBottom:28,flex:1},tlThumb:{width:112,height:63,objectFit:"cover",borderRadius:8,flexShrink:0},tlText:{flex:1},tlFile:{fontSize:11,color:o.muted,marginBottom:6},tlBrief:{fontSize:14,lineHeight:1.6,marginBottom:8},tlDelta:{fontSize:13,color:o.muted,lineHeight:1.5},liveLayout:{flex:1,display:"grid",gridTemplateColumns:"1fr 340px",overflow:"hidden"},feedGrid:{padding:20,display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(260px, 1fr))",gap:14,overflowY:"auto",alignContent:"start"},feedCard:{background:o.surface,borderRadius:12,border:"2px solid ".concat(o.border),overflow:"hidden",cursor:"pointer",transition:"border-color 0.15s"},feedCardOn:{borderColor:o.orange},feedHead:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"9px 12px",background:o.surface2},feedLabel:{fontSize:13,fontWeight:600},alertDot:{background:o.red,color:"#fff",borderRadius:"50%",minWidth:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,fontWeight:700,padding:"0 4px"},liveBadge:{fontSize:10,fontWeight:700,color:o.yellow,letterSpacing:1,animation:"pulse 1s infinite"},feedImg:{width:"100%",aspectRatio:"16/9",objectFit:"cover",display:"block"},feedNoImg:{aspectRatio:"16/9",display:"flex",alignItems:"center",justifyContent:"center",background:o.surface2,color:o.muted,fontSize:13},feedAlert:{padding:"7px 12px",background:"".concat(o.red,"18"),borderTop:"1px solid ".concat(o.red,"40")},feedAlertTime:{fontSize:10,color:o.muted,marginRight:6},feedAlertText:{fontSize:12},feedActions:{display:"flex",borderTop:"1px solid ".concat(o.border)},scanBtn:{flex:1,padding:"8px 4px",background:"transparent",border:"none",borderRight:"1px solid ".concat(o.border),color:o.orange,cursor:"pointer",fontSize:12,fontWeight:600},comms:{background:o.surface,borderLeft:"1px solid ".concat(o.border),display:"flex",flexDirection:"column",overflow:"hidden"},commsHead:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"14px 18px",borderBottom:"1px solid ".concat(o.border),fontWeight:700,fontSize:15},closeBtn:{background:"transparent",border:"none",color:o.muted,cursor:"pointer",fontSize:18},commsStatus:{padding:"8px 18px",borderBottom:"1px solid ".concat(o.border),fontSize:13,color:o.green,display:"flex",alignItems:"center",gap:8},dot:{width:8,height:8,borderRadius:"50%",background:o.green,display:"inline-block"},chatLog:{flex:1,padding:16,overflowY:"auto",display:"flex",flexDirection:"column",gap:12},chatEmpty:{fontSize:13,color:o.muted,textAlign:"center",marginTop:24},chatMsg:{display:"flex",flexDirection:"column",gap:3},chatMeta:{display:"flex",alignItems:"center",gap:8},chatFrom:{fontSize:11,fontWeight:700,color:o.orange},chatTime:{fontSize:11,color:o.muted},chatText:{fontSize:14,lineHeight:1.5},chatFooter:{padding:14,borderTop:"1px solid ".concat(o.border),display:"flex",gap:8},chatInput:{flex:1,padding:"9px 12px",background:o.surface2,border:"1px solid ".concat(o.border),borderRadius:8,color:o.text,fontSize:14,outline:"none"},expWrap:{flex:1,padding:28,overflowY:"auto",display:"flex",flexDirection:"column",gap:28},expHeader:{display:"flex",justifyContent:"space-between",alignItems:"center"},sectionTitle:{fontSize:22,fontWeight:700},expStats:{fontSize:14,color:o.muted},expTable:{borderRadius:12,overflow:"hidden",border:"1px solid ".concat(o.border)},expTableHead:{display:"grid",gridTemplateColumns:"150px 1fr 1fr",gap:16,padding:"10px 16px",background:o.surface2,fontSize:11,fontWeight:700,letterSpacing:1,textTransform:"uppercase",color:o.muted},expRow:{display:"grid",gridTemplateColumns:"150px 1fr 1fr",gap:16,padding:"14px 16px",borderTop:"1px solid ".concat(o.border),background:o.surface,fontSize:13,lineHeight:1.6},expRowThumbCol:{},expThumb:{width:"100%",borderRadius:6,marginBottom:6},expFilename:{fontSize:11,color:o.muted},expRowCell:{},expSubTitle:{fontSize:15,fontWeight:600,color:o.muted,marginBottom:12},expCard:{display:"flex",gap:16,background:o.surface,borderRadius:12,border:"1px solid ".concat(o.border),padding:16,marginBottom:12},expCardThumb:{width:110,height:62,objectFit:"cover",borderRadius:8,flexShrink:0},expCardMeta:{fontSize:12,color:o.muted,marginBottom:10},btnPri:{padding:"8px 18px",background:o.orange,border:"none",borderRadius:8,color:"#fff",cursor:"pointer",fontSize:14,fontWeight:600,whiteSpace:"nowrap"},btnSec:{padding:"8px 18px",background:"transparent",border:"1px solid ".concat(o.border),borderRadius:8,color:o.text,cursor:"pointer",fontSize:14,fontWeight:500,whiteSpace:"nowrap"},spinner:{width:28,height:28,border:"3px solid ".concat(o.border),borderTop:"3px solid ".concat(o.orange),borderRadius:"50%",animation:"spin 0.7s linear infinite"},loader:{display:"flex",flexDirection:"column",alignItems:"center",gap:14,padding:48},empty:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:12,padding:"60px 40px",textAlign:"center"},emptyIcon:{fontSize:48,marginBottom:4},emptyTitle:{fontSize:20,fontWeight:700},emptySub:{fontSize:14,color:o.muted,maxWidth:380,lineHeight:1.6}};t.default=function(){let[e,t]=(0,r.useState)(""),[n,o]=(0,r.useState)("review"),[u,h]=(0,r.useState)([]),[x,y]=(0,r.useState)({}),[b,v]=(0,r.useState)({}),[j,S]=(0,r.useState)({}),[k,T]=(0,r.useState)([]),[D,I]=(0,r.useState)(null),[z,R]=(0,r.useState)({}),[A,W]=(0,r.useState)(!1),[L,N]=(0,r.useState)(null),[F,O]=(0,r.useState)({}),[E,M]=(0,r.useState)({}),[H,_]=(0,r.useState)(null),P=(0,r.useMemo)(()=>{let e={};return u.forEach(t=>{e[t.siteId]||(e[t.siteId]=[]),e[t.siteId].push(t)}),Object.keys(e).forEach(t=>e[t].sort((e,t)=>e.timestamp-t.timestamp)),e},[u]),q=e=>R(t=>({...t,[e]:!0})),K=e=>R(t=>{let n={...t};return delete n[e],n}),U=async e=>{W(!0);let t=[];for(let n of Array.from(e)){let e=n.name.split(".").pop().toLowerCase();if(["mp4","mov","webm","avi","mkv"].includes(e)){N({file:n.name,cur:0,tot:"?"});let e=await c(n,5,(e,t)=>N({file:n.name,cur:e,tot:t}));t.push(...e)}else["jpg","jpeg","png","webp","gif"].includes(e)&&(t.push(await p(n)),N({file:n.name,cur:1,tot:1}))}h(e=>[...e,...t]),W(!1),N(null)},G=async t=>{let n="bl_".concat(t.id);q(n);try{let n=await l(e,[s(t.imageData,a.baseline)]);return T(e=>[...e,{id:Date.now(),type:"baseline",frameId:t.id,thumb:t.imageData,filename:t.filename,prompt:a.baseline,response:n,ts:new Date().toISOString()}]),n}catch(e){_(e.message)}finally{K(n)}},Y=async function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i="tc_".concat(t.id);q(i);try{let i=await d(e,t,n);return y(e=>({...e,[t.id]:i})),T(e=>[...e,{id:Date.now(),type:"technique",frameId:t.id,thumb:t.imageData,filename:t.filename,prompt:"Zone + Relationship + Briefing chain",response:i.briefing,fullAnalysis:i,ts:i.ts}]),i}catch(e){_(e.message)}finally{K(i)}},Z=async t=>{let n=(P[t]||[]).slice(0,6);if(n.length){q("chain_".concat(t));try{let i=[],r=null;for(let t of n){let n=await d(e,t,r);y(e=>({...e,[t.id]:n})),i.push({frame:t,analysis:n}),r="".concat(n.zoneAnalysis,"\n\n").concat(n.relationships)}let o=i.map((e,t)=>"Time ".concat(t+1,":\n").concat(e.analysis.briefing)).join("\n\n---\n\n"),s=await l(e,[{role:"user",content:"Across ".concat(i.length," time periods on this construction site:\n\n").concat(o,"\n\n").concat(a.briefing)}],512);v(e=>({...e,[t]:{text:s,ts:new Date().toISOString()}})),S(e=>({...e,[t]:i}))}finally{K("chain_".concat(t))}}};return(0,i.jsxs)("div",{style:B.app,children:[(0,i.jsx)(g,{apiKey:e,onKey:t,mode:n,onMode:o}),"review"===n&&(0,i.jsx)(m,{sites:P,analyses:x,siteBriefs:b,chains:j,loading:z,ingesting:A,ingestProg:L,selectedSite:D,onSelectSite:I,onIngest:U,onRunBaseline:G,onRunTechnique:Y,onRunChain:Z,siteAlertLevel:e=>{var t;return f(null===(t=b[e])||void 0===t?void 0:t.text)},apiKey:e}),"live"===n&&(0,i.jsx)(w,{sites:P,liveAlerts:F,chatLogs:E,loading:z,apiKey:e,onAlert:(e,t)=>O(n=>({...n,[e]:[...n[e]||[],t]})),onChat:(e,t)=>M(n=>({...n,[e]:[...n[e]||[],t]}))}),"experiments"===n&&(0,i.jsx)(C,{experiments:k,loading:z})]})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=4613)}),_N_E=e.O()}]);